<div class="container">
    <div class="p-grid">

        <div class="p-col-10">
            <div *ngIf="supermercadoComAvaliacao">
                <div >
                    <div>
                        <h2>{{supermercadoComAvaliacao.supermercado.nome}}</h2>
                        <p>{{ supermercadoComAvaliacao.supermercado.descricao }}</p>
                        <p-rating [ngModel]="supermercadoComAvaliacao.mediaDasAvaliacoes" readonly="true" stars="5" [cancel]="false"></p-rating>
                        <p>
                            <span *ngIf="supermercadoComAvaliacao.supermercado.tempoDeEntregaMinimoEmMinutos"> Entrega: {{supermercadoComAvaliacao.supermercado.tempoDeEntregaMinimoEmMinutos}} min</span>
                            <span *ngIf="supermercadoComAvaliacao.supermercado.tempoDeEntregaMaximoEmMinutos"> - {{supermercadoComAvaliacao.supermercado.tempoDeEntregaMaximoEmMinutos}} min</span>
                        </p>
                        <p>Taxa: {{ supermercadoComAvaliacao.supermercado.taxaDeEntregaEmReais | currency:'BRL' }}</p>
                    </div>
                </div>

                <p-tabView>
                    <p-tabPanel header="Produtos">
                        <div class="p-grid">
                            <div *ngFor="let produto of estoque" >
                                <div class="p-col" >  
                                    <p-card header="{{produto.item.nome | uppercase }}" 
                                            subheader="{{produto.item.descricao }}"
                                            [style]="{width: '360px', height: '180px'}" styleClass="ui-card-shadow">
                                        <!--p-header>
                                            <img src="Card" src="assets/showcase/images/usercard.png">
                                        </p-header-->
                                        <p *ngIf="!produto.precoPromocional"> {{produto.preco | currency:'BRL'  }}</p>
                                        <p *ngIf="produto.precoPromocional"> De: <del> {{produto.preco | currency:'BRL'  }} </del></p>
                                        <p *ngIf="produto.precoPromocional"> Por: {{produto.precoPromocional | currency:'BRL'  }}</p>
                                        
                                        <p-footer>
                                            <button pButton 
                                            (click)="escolheItem(produto.item)"
                                            type="button" label="Escolher" style="margin-right: .25em"></button>
                                        </p-footer>
                                    </p-card>
                                </div>
                            </div>
                        </div>
                    </p-tabPanel>

                    <p-tabPanel header="Avaliações" rightIcon="pi pi-star">
                                <p-rating [ngModel]="supermercadoComAvaliacao.mediaDasAvaliacoes" readonly="true" stars="5" [cancel]="false"></p-rating>
                                <p>{{supermercadoComAvaliacao.mediaAvaliacoes | number:'1.1-1' }} de {{avaliacoes.length}} {{avaliacoes.length > 1 ? 'avaliações' : 'avaliação'}}</p>
                                <div *ngFor="let avaliacao of avaliacoes">
                                    <p>{{ avaliacao.nota }} • {{ avaliacao.comentario }}</p>
                                </div>

                    </p-tabPanel>
                </p-tabView>
            </div>
        </div>

        <div class="p-col-2">
            <div *ngIf="supermercadoComAvaliacao">
                <h3>Pedido</h3>
                <div *ngFor="let itemPedido of pedido.itens">
                    <hr>
                    <p>{{ itemPedido.quantidade }}x {{ itemPedido.item.nome }}
                        {{ calculaSubTotal(itemPedido) | currency:'BRL' }}<br>
                        <span class="text-muted"><small>{{ itemPedido.observacao }}</small></span>
                    </p>
                    <button pButton
                        (click)="editaItemDoPedido(itemPedido)"
                        label="Editar" class="ui-button-secondary"></button>
                        <button pButton (click)="removeItemDoPedido(itemPedido)"
                        label="Remover" class="ui-button-secondary"></button>
                </div>
                <hr>
                <p>Taxa de entrega:
                {{ supermercadoComAvaliacao.supermercado.taxaDeEntregaEmReais ? (supermercadoComAvaliacao.supermercado.taxaDeEntregaEmReais | currency:'BRL') : 'Grátis' }}</p>
                <p class="font-weight-bolder">Total: {{ totalDoPedido() | currency:'BRL' }}</p>
                <button pButton (click)="fazPedido()" label="Fazer Pedido"></button>
            </div>
        </div> 

    </div>
</div>

<div *ngIf="itemDoPedidoEscolhido">
    <p-dialog header="{{ itemDoPedidoEscolhido.item.nome }}" [(visible)]="displayModalPedido" [modal]="true" 
        [responsive]="true" [style]="{width: '350px', minWidth: '200px'}" [minY]="70">
            <form #itemDoPedidoEscolhidoForm="ngForm" (ngSubmit)="salvaItemNoPedido()">
                <div class="form-group">
                    <label for="quantidade">Quantidade</label>
                    <input class="form-control" type="number" min="1" id="quantidade" name="quantidade"
                    [(ngModel)]="itemDoPedidoEscolhido.quantidade">
                </div>
                <div class="form-group">
                    <label for="observacao">Observação</label>
                    <textarea class="form-control" id="observacao" name="observacao"
                    [(ngModel)]="itemDoPedidoEscolhido.observacao"></textarea>
                </div>
                
                <button pButton type="submit" style="margin-right: .25em"
                    [disabled]="!itemDoPedidoEscolhidoForm.form.valid"
                    label="{{adicionandoItemAoPedido ? 'Adicionar':'Atualizar'}}"></button>

                <button pButton type="button" style="margin-right: .25em" 
                (click)="showHideDialogPedido()" label="Cancelar"></button>
            </form>
        
    </p-dialog>
</div>

<p-dialog header="Dados da Entrega" [(visible)]="displayModalEntrega" [modal]="true" 
    [responsive]="true" >
        <form #entregaForm="ngForm" (ngSubmit)="registraEntrega()">
          <fieldset>
            <legend>Dados pessoais</legend>
            <div class="form-group">
              <label for="nome">Nome:</label>
              <input class="form-control" required id="nome" name="nome" maxlength="100"
                [(ngModel)]="pedido.entrega.cliente.nome" placeholder="digite seu nome">
            </div>
            <div class="form-group">
              <label for="cpf">CPF:</label>
              <input class="form-control" required id="cpf" name="cpf" maxlength="15"
                [(ngModel)]="pedido.entrega.cliente.cpf" placeholder="000.000.000-00" [textMask]="{mask: cpfMask}">
            </div>
            <div class="form-group">
              <label for="email">Email:</label>
              <input class="form-control" required type="email" id="email" name="email" maxlength="100"
                [(ngModel)]="pedido.entrega.cliente.email" placeholder="email@exemplo.com">
            </div>
            <div class="form-group">
              <label for="telefone">Telefone:</label>
              <input class="form-control" required id="telefone" name="telefone" maxlength="16"
                [(ngModel)]="pedido.entrega.cliente.telefone" [textMask]="{mask: telefoneMask}"  placeholder="(00) 0000-0000">
            </div>
          </fieldset>
          <fieldset>
            <legend>Local de entrega</legend>
            <div class="form-group">
              <label for="cep">CEP:</label>
              <input class="form-control" required id="cep" name="cep" maxlength="10"
                [(ngModel)]="pedido.entrega.cep" [textMask]="{mask: cepMask}">
            </div>
            <div class="form-group">
              <label for="endereco">Endereço:</label>
              <textarea class="form-control" required id="endereco" name="endereco"
                [(ngModel)]="pedido.entrega.endereco" placeholder="rua, número, bloco, bairro, ..."></textarea>
            </div>
            <div class="form-group">
              <label for="complemento">Complemento:</label>
              <textarea class="form-control" id="complemento" name="complemento"
                [(ngModel)]="pedido.entrega.complemento"></textarea>
            </div>
          </fieldset>
          <button pButton type="submit" [disabled]="!entregaForm.form.valid" label="Confirmar"></button>
          <button pButton type="button" (click)="showHideDialogEntrega()" label="Cancelar"></button>
        </form>
</p-dialog>